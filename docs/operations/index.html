<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=en class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><link rel="shortcut icon" href=../../favicons/favicon.ico><link rel=apple-touch-icon href=../../favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=../../favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=../../favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=../../favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=../../favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=../../favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=../../favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=../../favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=../../favicons/android-192x192.png sizes=192x192><title>Operations |</title><meta name=description content="API wfx provides two RESTful APIs to interact with it: the northbound operator/management interface and the southbound interface used by clients as illustrated in the following figure:
Management │ │ ▼ Northbound API ┌──────────────────┐ │ wfx │ └──────────────────┘ ▲ Southbound API │ │ Device The northbound API is used to create jobs and execute server-side state transitions, whereas the southbound API is used for client-side transitions."><meta property="og:url" content="/docs/operations/"><meta property="og:title" content="Operations"><meta property="og:description" content="API wfx provides two RESTful APIs to interact with it: the northbound operator/management interface and the southbound interface used by clients as illustrated in the following figure:
Management │ │ ▼ Northbound API ┌──────────────────┐ │ wfx │ └──────────────────┘ ▲ Southbound API │ │ Device The northbound API is used to create jobs and execute server-side state transitions, whereas the southbound API is used for client-side transitions."><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="docs"><meta itemprop=name content="Operations"><meta itemprop=description content="API wfx provides two RESTful APIs to interact with it: the northbound operator/management interface and the southbound interface used by clients as illustrated in the following figure:
Management │ │ ▼ Northbound API ┌──────────────────┐ │ wfx │ └──────────────────┘ ▲ Southbound API │ │ Device The northbound API is used to create jobs and execute server-side state transitions, whereas the southbound API is used for client-side transitions."><meta itemprop=wordCount content="2464"><meta name=twitter:card content="summary"><meta name=twitter:title content="Operations"><meta name=twitter:description content="API wfx provides two RESTful APIs to interact with it: the northbound operator/management interface and the southbound interface used by clients as illustrated in the following figure:
Management │ │ ▼ Northbound API ┌──────────────────┐ │ wfx │ └──────────────────┘ ▲ Southbound API │ │ Device The northbound API is used to create jobs and execute server-side state transitions, whereas the southbound API is used for client-side transitions."><link rel=preload href=../../scss/main.min.ca7737d486fe1427b06aa4b086461ba6b08453503a0f2765aa948192b503c404.css as=style integrity="sha256-ync31Ib+FCewaqSwhkYbprCEU1A6DydlqpSBkrUDxAQ=" crossorigin=anonymous><link href=../../scss/main.min.ca7737d486fe1427b06aa4b086461ba6b08453503a0f2765aa948192b503c404.css rel=stylesheet integrity="sha256-ync31Ib+FCewaqSwhkYbprCEU1A6DydlqpSBkrUDxAQ=" crossorigin=anonymous><script src=https://code.jquery.com/jquery-3.7.1.min.js integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin=anonymous></script><script defer src=https://unpkg.com/lunr@2.3.9/lunr.min.js integrity=sha384-203J0SNzyqHby3iU6hzvzltrWi/M41wOP5Gu+BiJMz5nwKykbkUx8Kp7iti0Lpli crossorigin=anonymous></script></head><body class=td-page><header><nav class="td-navbar js-navbar-scroll" data-bs-theme=dark><div class="container-fluid flex-column flex-md-row"><a class=navbar-brand href=../../><span class="navbar-brand__logo navbar-logo"><svg id="Ebene_1" width="477.65" height="263.3" viewBox="0 0 955.3 526.6"><style id="style56">.st0{fill:#00c1b6}.st1{fill:#1b9a99}</style><g id="Ebene_1_00000104692970429684080800000006472111204584987530_" transform="translate(-490.1 -233.3)"><path id="path58" d="m1163.3 569.5-97.2-52.2c-7.5-4-16.7 1.4-16.7 10v104.3c0 8.6 9.1 14 16.7 10l97.2-52.2c8-4.2 8-15.6.0-19.9zM777.8 673.3v86.6H625.6c-74.8.0-135.5-60.7-135.5-135.5v-146c10.5 12 26 19.6 43.2 19.6 17.3.0 32.9-7.7 43.4-19.9v146.3c0 27 21.9 48.9 48.9 48.9z" class="st0"/><path id="path60" d="M776.8 759.9c-74.8.0-135.5-60.7-135.5-135.5V441.1c0-23.9 19.4-43.3 43.3-43.3s43.3 19.4 43.3 43.3v183.4c0 27 21.9 48.9 48.9 48.9h15.7v-189c0-47.8 38.8-86.6 86.6-86.6v259.8c0 56.5-45.8 102.3-102.3 102.3z" class="st1"/><path id="path62" d="M1146.3 759.4h-19.1c-23.9.0-43.3-19.4-43.3-43.3s19.4-43.3 43.3-43.3h14.4c27 0 48.9-21.9 48.9-48.9v-87.3c0-28.8-23.4-52.2-52.2-52.2h-261v-86.6h261c76.7.0 138.8 62.1 138.8 138.8v92c0 72.3-58.6 130.8-130.8 130.8z" class="st1"/><path id="path64" d="M1445.4 441.1c0 12-4.8 22.8-12.7 30.6-7.8 7.8-18.7 12.7-30.6 12.7h-72.8c-27 0-48.9 21.9-48.9 48.9v92c0 26.3 21.3 47.5 47.5 47.5h37c-12.3 10.5-20 26.1-20 43.5.0 17.1 7.6 32.5 19.5 43.1h-31.8c-76.7.0-138.8-62.1-138.8-138.8v-87.3c0-74.8 60.7-135.5 135.5-135.5h72.8c23.9.0 43.3 19.4 43.3 43.3zm-347.1-121.2h-23c-27 0-48.9 21.9-48.9 48.9V716c0 23.9-19.4 43.3-43.3 43.3s-43.3-19.4-43.3-43.3V368.8c0-74.8 60.7-135.5 135.5-135.5h23.2c-12.2 10.5-19.9 26.1-19.9 43.4.0 17.2 7.6 32.7 19.7 43.2z" class="st1"/><circle id="circle66" cx="1136" cy="276.7" r="43.1" class="st1"/><circle id="circle68" cx="1402.3" cy="716.3" r="43.1" class="st1"/><circle id="circle70" cx="533.3" cy="440.7" r="43.1" class="st0" transform="rotate(-80.781 533.308 440.692)"/></g></svg></span><span class=navbar-brand__name></span></a><div class="td-navbar-nav-scroll ms-md-auto" id=main_navbar><ul class=navbar-nav><li class=nav-item><a class="nav-link active" href=../../docs/><span>Documentation</span></a></li></ul></div><div class="d-none d-lg-block"><div class="td-search td-search--offline"><div class=td-search__icon></div><input type=search class="td-search__input form-control" placeholder="Search this site…" aria-label="Search this site…" autocomplete=off data-offline-search-index-json-src=../../offline-search-index.9990abbee3f2b4cd551bc70222cee73c.json data-offline-search-base-href=../../ data-offline-search-max-results=10></div></div></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><aside class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none"><div id=td-sidebar-menu class=td-sidebar__inner><form class="td-sidebar__search d-flex align-items-center"><div class="td-search td-search--offline"><div class=td-search__icon></div><input type=search class="td-search__input form-control" placeholder="Search this site…" aria-label="Search this site…" autocomplete=off data-offline-search-index-json-src=../../offline-search-index.9990abbee3f2b4cd551bc70222cee73c.json data-offline-search-base-href=../../ data-offline-search-max-results=10></div><button class="btn btn-link td-sidebar__toggle d-md-none p-0 ms-3 fas fa-bars" type=button data-bs-toggle=collapse data-bs-target=#td-section-nav aria-controls=td-section-nav aria-expanded=false aria-label="Toggle section navigation"></button></form><nav class="td-sidebar-nav collapse" id=td-section-nav><ul class="td-sidebar-nav__section pe-md-3 ul-0"><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m-docs-li><a href=../../docs/ class="align-left ps-0 td-sidebar-link td-sidebar-link__section tree-root" id=m-docs><span>Documentation</span></a><ul class=ul-1><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsinstallation-li><a href=../../docs/installation/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docsinstallation><span>Build and Installation</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsconfiguration-li><a href=../../docs/configuration/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docsconfiguration><span>Configuration</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child active-path" id=m-docsoperations-li><a href=../../docs/operations/ class="align-left ps-0 active td-sidebar-link td-sidebar-link__page" id=m-docsoperations><span class=td-sidebar-nav-active-item>Operations</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsapi-li><a href=../../docs/api/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docsapi><span>REST API</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsuse-cases-li><a href=../../docs/use-cases/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docsuse-cases><span>Use Cases</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-docsworkflows-li><a href=../../docs/workflows/ class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-docsworkflows><span>Workflows</span></a><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsworkflowsdau-li><a href=../../docs/workflows/dau/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docsworkflowsdau><span>Device Artifact Update (DAU)</span></a></li></ul></li></ul></li></ul></nav></div></aside><aside class="d-none d-xl-block col-xl-2 td-sidebar-toc d-print-none"><div class="td-page-meta ms-2 pb-1 pt-2 mb-0"></div><div class=td-toc><nav id=TableOfContents><ul><li><a href=#api>API</a><ul><li><a href=#job-events>Job Events</a></li><li><a href=#response-filters>Response Filters</a></li><li><a href=#health-check>Health Check</a></li><li><a href=#wfx-version>wfx Version</a></li></ul></li><li><a href=#deployment>Deployment</a></li><li><a href=#plugins>Plugins</a><ul><li><a href=#design-choices>Design Choices</a></li><li><a href=#using-plugins>Using Plugins</a></li><li><a href=#developing-plugins>Developing Plugins</a></li><li><a href=#use-cases>Use Cases</a></li><li><a href=#example>Example</a></li></ul></li><li><a href=#telemetry>Telemetry</a></li><li><a href=#performance--benchmarking>Performance / Benchmarking</a></li></ul></nav></div></aside><main class="col-12 col-md-9 col-xl-8 ps-md-5" role=main><nav aria-label=breadcrumb class=td-breadcrumbs><ol class=breadcrumb><li class=breadcrumb-item><a href=../../docs/>Documentation</a></li><li class="breadcrumb-item active" aria-current=page>Operations</li></ol></nav><div class=td-content><h1>Operations</h1><header class=article-meta></header><h2 id=api>API</h2><p>wfx provides two RESTful APIs to interact with it: the northbound operator/management interface and the southbound
interface used by clients as illustrated in the following figure:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-txt data-lang=txt><span style=display:flex><span>     Management
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>         │
</span></span><span style=display:flex><span>         │
</span></span><span style=display:flex><span>         ▼ Northbound API
</span></span><span style=display:flex><span>┌──────────────────┐
</span></span><span style=display:flex><span>│       wfx        │
</span></span><span style=display:flex><span>└──────────────────┘
</span></span><span style=display:flex><span>         ▲ Southbound API
</span></span><span style=display:flex><span>         │
</span></span><span style=display:flex><span>         │
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      Device
</span></span></code></pre></div><p>The northbound API is used to create jobs and execute server-side state transitions, whereas the southbound API is used
for client-side transitions.</p><p>The complete
<a href=../../wfx.openapi.yml>wfx API specification</a> is accessible at runtime via the <code>/api/wfx/v1/openapi.json</code>
endpoint. Clients may inspect this specification at run-time so to obey the various limits imposed, e.g, for parameter
value ranges and array lengths.</p><h3 id=job-events>Job Events</h3><p>Job events provide a notification mechanism that informs clients about certain operations happening on jobs. This
approach eliminates the need for clients to continuously poll wfx, thus optimizing network usage and client resources.
Job events can be useful for user interfaces (UIs) and other applications that demand near-instantaneous updates.</p><h4 id=architecture>Architecture</h4><p>Below is a high-level overview of how the communication flow operates:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-txt data-lang=txt><span style=display:flex><span> ┌────────┐                            ┌─────┐
</span></span><span style=display:flex><span> │ Client │                            │ wfx │
</span></span><span style=display:flex><span> └────────┘                            └─────┘
</span></span><span style=display:flex><span>     |                                    |
</span></span><span style=display:flex><span>     |        HTTP GET /jobs/events       |
</span></span><span style=display:flex><span>     |-----------------------------------►|
</span></span><span style=display:flex><span>     |                                    |
</span></span><span style=display:flex><span>     |                                    |
</span></span><span style=display:flex><span>     |           Event Loop               |
</span></span><span style=display:flex><span> ┌───|────────────────────────────────────|───┐
</span></span><span style=display:flex><span> │   |  [Content-Type: text/event-stream] |   │
</span></span><span style=display:flex><span> │   |                                    |   │
</span></span><span style=display:flex><span> │   |                                    |   │
</span></span><span style=display:flex><span> │   |            Push Event              |   │
</span></span><span style=display:flex><span> │   |◄-----------------------------------|   │
</span></span><span style=display:flex><span> │   |                                    |   │
</span></span><span style=display:flex><span> └───|────────────────────────────────────|───┘
</span></span><span style=display:flex><span>     |                                    |
</span></span><span style=display:flex><span>     ▼                                    ▼
</span></span><span style=display:flex><span> ┌────────┐                            ┌─────┐
</span></span><span style=display:flex><span> │ Client │                            │ wfx │
</span></span><span style=display:flex><span> └────────┘                            └─────┘
</span></span></code></pre></div><ol><li>The client initiates communication by sending an HTTP <code>GET</code> request to the <code>/jobs/events</code> endpoint. Clients may also
include optional
<a href=#filter-parameters>filter parameters</a> within the request.</li><li>Upon receipt of the request, <code>wfx</code> sets the <code>Content-Type</code> header to <code>text/event-stream</code>.</li><li>The server then initiates a stream of job events in the response body, allowing clients to receive instant updates.</li></ol><p><strong>Note</strong>: To prevent the connection from being closed due to inactivity (e.g., when no job events occur), periodic
keep-alive events are sent during such idle periods. This ensures that the connection remains open, preventing closure
by proxies, the kernel, or other entities since it may not be possible to control all involved parties. The keep-alive
events are technically comments (as defined in the SSE specification) and must be ignored by clients.</p><h4 id=event-format-specification>Event Format Specification</h4><p>The job events stream is composed of
<a href=https://developer.mozilla.org/en-US/docs/Web/API/Server-sent_events target=_blank>server-sent
events</a> (SSE). Accordingly, the stream is
structured as follows:</p><pre><code>data: [...]
id: 1

data: [...]
id: 2

[...]

: keepalive

data: [...]
id: 42

[...]
</code></pre><p>An individual event within the stream conforms to this format:</p><pre><code>data: { &quot;action&quot;: &quot;&lt;ACTION&gt;&quot;, &quot;ctime&quot;: &lt;CTIME&gt;, &quot;tags&quot;: &lt;TAGS&gt;, &quot;job&quot;: &lt;JOB&gt; }
id: &lt;EVENT_ID&gt;\n\n
</code></pre><p><strong>Note</strong>: Each event is terminated by a pair of newline characters <code>\n\n</code> (as required by the SSE spec).</p><p>The semantics of the individual fields is:</p><ul><li><code>&lt;ACTION></code> specifies the type of event that occurred. The valid actions are:<ul><li><code>CREATE</code>: a new job has been created</li><li><code>DELETE</code>: an existing job has been deleted</li><li><code>ADD_TAGS</code>: tags were added to a job</li><li><code>DELETE_TAGS</code>: tags were removed from a job</li><li><code>UPDATE_STATUS</code>: job status has been updated</li><li><code>UPDATE_DEFINITION</code>: job definition has been updated</li></ul></li><li><code>&lt;CTIME></code>: event creation time (ISO8601)</li><li><code>&lt;TAGS></code>: JSON array of tags as provided by the client</li><li><code>&lt;JOB></code> is a JSON object containing the portion of the job object which was changed, e.g., for an <code>UPDATE_STATUS</code>
event, the job status is sent but not its definition. To enable
<a href=#filter-parameters>filtering</a>, the fields <code>id</code>,
<code>clientId</code> and <code>workflow.name</code> are <em>always</em> part of the response.</li><li><code>&lt;EVENT_ID></code>: an integer which uniquely identifies each event, starting at 1 and incrementing by 1 for every
subsequent event. Clients can use this to identify any missed messages. If an overflow occurs, the integer resets to
zero, a scenario the client can recognize and address.</li></ul><p><strong>Example:</strong></p><pre><code>data: {&quot;action&quot;:&quot;UPDATE_STATUS&quot;,&quot;job&quot;:{&quot;clientId&quot;:&quot;Dana&quot;,&quot;id&quot;:&quot;c6698105-6386-4940-a311-de1b57e3faeb&quot;,&quot;status&quot;:{&quot;definitionHash&quot;:&quot;adc1cfc1577119ba2a0852133340088390c1103bdf82d8102970d3e6c53ec10b&quot;,&quot;state&quot;:&quot;PROGRESS&quot;},&quot;workflow&quot;:{&quot;name&quot;:&quot;wfx.workflow.kanban&quot;}}}
id: 1\n\n
</code></pre><h4 id=filter-parameters>Filter Parameters</h4><p>Job events can be filtered using any combination of the following parameters:</p><ul><li>Job IDs</li><li>Client IDs</li><li>Workflow Names</li></ul><p>This enables more precise control over the dispatched events. Note that it is entirely possible to subscribe multiple
times to job events using various filters in order to create a more advanced event recognition model.</p><h4 id=examples>Examples</h4><p><code>wfxctl</code> offers a reference client implementation. The following command subscribes to <strong>all</strong> job events:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>wfxctl job events
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#57606a># auto reconnect if connection is lost; also waits for wfx to be up and running.</span>
</span></span><span style=display:flex><span>wfxctl job events --auto-reconnect
</span></span></code></pre></div><p><strong>Note</strong>: The <code>--auto-reconnect</code> flag should be used with caution, as it may result in missed events after a connection
loss. When this flag is used, <code>wfxctl</code> does not terminate upon losing the connection, so its logs should be monitored to
detect such occurrences. After a connection loss, fetching the job&rsquo;s current status and comparing it with the received
events can help identify any missed events.</p><p>The above commands monitor events for <em>all</em> jobs globally, which may result in a large number of events. For a more
targeted approach, filter parameters may be used. Assuming the job IDs are known (either because the jobs have been
created already or the IDs are received via another subscription channel), the following will subscribe to events
matching either of the two specified job IDs:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>wfxctl job events --job-id<span style=color:#0550ae>=</span>d305e539-1d41-4c95-b19a-2a7055c469d0 --job-id<span style=color:#0550ae>=</span>e692ad92-45e6-4164-b3fd-8c6aa884011c
</span></span></code></pre></div><p>See <code>wfxctl job events --help</code> for other filter parameters, e.g. workflow names.</p><h4 id=considerations-and-limitations>Considerations and Limitations</h4><ol><li><strong>Asynchronous Job Status Updates</strong>: Job status updates are dispatched asynchronously to avoid the risk of a
subscriber interfering with the actual job operation. In particular, there is no guarantee that the messages sent to
the client arrive in a linear order (another reason for that may be networking-related). While this is typically not
a concern, it could become an issue in high-concurrency situations. For example, when multiple clients try to modify
the same job or when a single client issues a rapid sequence of status updates. As a result, messages could arrive
in a not necessarily linear order, possibly deviating from the client&rsquo;s expectation. However, the client can use the
(event) <code>id</code> and <code>ctime</code> fields to establish a natural ordering of events as emitted by wfx.</li><li><strong>Unacknowledged Server-Sent Events (SSE)</strong>: SSE operates on a one-way communication model and does not include an
acknowledgment or handshake protocol to confirm message delivery. This design choice aligns with the fundamental
principles of SSE but does mean that there&rsquo;s a possibility some events may not reach the intended subscriber (which
the client can possibly detect by keeping track of SSE event IDs).</li><li><strong>Event Stream Orchestration</strong>: Each wfx instance only yields the events happening on that instance. Consequently,
if there are multiple wfx instances, a consolidated &ldquo;global&rdquo; event stream can only be assembled by subscribing to
all wfx instances (and aggregating the events).</li><li><strong>Browser Connection Limits for SSE</strong>: Web browsers typically restrict the number of SSE connections to six per
domain.</li><li><strong>HTTP/2</strong>: Not supported currently. The HTTP protocol is limited to HTTP/1.1.</li></ol><h3 id=response-filters>Response Filters</h3><p>wfx allows server-side response content filtering prior to sending the response to the client so to tailor it to client
information needs. For example, if a client isn&rsquo;t interested in the job&rsquo;s history, it may request to omit it in wfx
responses ― which also saves bandwidth. To this end, clients send a custom HTTP header, <code>X-Response-Filter</code>, with a
<a href=https://stedolan.github.io/jq/ target=_blank><code>jq</code></a>-like expression value. For example, assuming a job with ID 1 exists,</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>curl -s -f http://localhost:8080/api/wfx/v1/jobs/1/status <span style=color:#0a3069>\
</span></span></span><span style=display:flex><span><span style=color:#0a3069></span>  -H <span style=color:#0a3069>&#34;X-Response-Filter: .state&#34;</span>
</span></span></code></pre></div><p>returns the current <code>state</code> of the job as a string.</p><p>Note that the (filtered) response might no longer be a valid JSON expression as is the case in this example. It&rsquo;s the
client&rsquo;s responsibility to handle the filtered response properly ― which it asked for being filtered in the first place.</p><h3 id=health-check>Health Check</h3><p>wfx includes an internal health check service that&rsquo;s accessible at <code>/health</code>, e.g., via</p><pre><code>curl http://localhost:8080/health
</code></pre><p>in standard
<a href=../../docs/configuration/>configuration</a> or, alternatively,</p><pre><code>wfxctl health
</code></pre><h3 id=wfx-version>wfx Version</h3><p>The version of wfx running is accessible at <code>/version</code>, e.g., via</p><pre><code>curl http://localhost:8080/version
</code></pre><p>in standard
<a href=../../docs/configuration/>configuration</a> or, alternatively,</p><pre><code>wfxctl version
</code></pre><h2 id=deployment>Deployment</h2><p>To assist a secure deployment, both, the northbound operator/management interface and the southbound client interface,
are isolated from each other by being bound to distinct ports so that, e.g., a firewall can be used to steer and
restrict access.</p><p>While this separation provides a basic level of security, it doesn&rsquo;t prevent clients interfering with each other: For
example, there is no mechanism in place to prevent a client <code>A</code> from updating the jobs of another client <code>B</code>. This is a
deliberate design choice following the Unix philosophy of &ldquo;Make each program do one thing well&rdquo;. It allows for flexible
integration of wfx into existing or new infrastructure. Existing infrastructure most probably has request authentication
and authorization measures in place. For new infrastructure, such a feature is likely better provided by specialized
components/services supporting the overall deployment security architecture.</p><p>Thus, for productive deployments, a deployment along the lines of the following figure is recommended with an <em>API
Gateway</em> subsuming the discussed security requirements and performing access steering with regard to, e.g., client
access.</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-txt data-lang=txt><span style=display:flex><span>┌──────────────────┐
</span></span><span style=display:flex><span>│    Operator /    │
</span></span><span style=display:flex><span>│    Management    │
</span></span><span style=display:flex><span>└──────────────────┘
</span></span><span style=display:flex><span>         │
</span></span><span style=display:flex><span>         │ Request Authentication &amp; Authorization
</span></span><span style=display:flex><span>         ▼
</span></span><span style=display:flex><span>┌──────────────────┐
</span></span><span style=display:flex><span>│   API Gateway    │
</span></span><span style=display:flex><span>└──────────────────┘
</span></span><span style=display:flex><span>         │
</span></span><span style=display:flex><span>         │ Northbound: Management API
</span></span><span style=display:flex><span>         ▼
</span></span><span style=display:flex><span>┌──────────────────┐
</span></span><span style=display:flex><span>│       wfx        │
</span></span><span style=display:flex><span>└──────────────────┘
</span></span><span style=display:flex><span>         ▲
</span></span><span style=display:flex><span>         │ Southbound: Client API
</span></span><span style=display:flex><span>         │
</span></span><span style=display:flex><span>┌──────────────────┐
</span></span><span style=display:flex><span>│   API Gateway    │
</span></span><span style=display:flex><span>└──────────────────┘
</span></span><span style=display:flex><span>         ▲
</span></span><span style=display:flex><span>         │ Request Authentication &amp; Authorization
</span></span><span style=display:flex><span>         │
</span></span><span style=display:flex><span> ┌──────────────────┐
</span></span><span style=display:flex><span>┌┴─────────────────┐│
</span></span><span style=display:flex><span>│      Client      ├┘
</span></span><span style=display:flex><span>└──────────────────┘
</span></span></code></pre></div><h2 id=plugins>Plugins</h2><p>wfx offers a flexible (out-of-tree) plugin mechanism for extending its request processing capabilities. A plugin
functions as a subprocess, both initiated and supervised by wfx. Communication between the plugin and wfx is facilitated
through the exchange of
<a href=https://flatbuffers.dev/ target=_blank>flatbuffer</a> messages over stdin/stdout, thus permitting plugins to be
developed in <em>any</em> programming language.</p><h3 id=design-choices>Design Choices</h3><p>Due to the potential use of plugins for authentication, it is critical that <strong>all requests are passed through the
plugins</strong> before further processing and that that <strong>no request can slip through</strong> without being processed by the
plugins. This has led to the following deliberate design choices:</p><ol><li>Should any plugin <strong>exit</strong> (e.g., due to a crash), <strong>wfx is designed to terminate gracefully</strong>. While it might be
feasible for wfx to attempt restarting the affected plugins, this responsibility is more suitably handled by a
dedicated process supervisor like systemd. The shutdown of wfx enables the process supervisor to restart wfx, which,
in turn, starts all its plugins again.</li><li>All plugins are <strong>initialized before wfx starts processing any requests</strong>. In particular, after the completion of
wfx&rsquo;s startup phase, it&rsquo;s not possible to add or remove any plugins.</li><li>Plugins are expected to function properly. Specifically, if a plugin returns an invalid response type or an
unexpected response (for example, in response to a request that was never sent to the plugin), wfx will terminate
gracefully. This is because such behavior usually indicates a misconfiguration. The overall strategy is to fail fast
and early.</li></ol><h3 id=using-plugins>Using Plugins</h3><p>To use plugins at runtime, wfx must be compiled with the <code>plugin</code> tag (enabled by default) and started with the
<code>--mgmt-plugins-dir</code> resp. <code>--client-plugins-dir</code> flag, specifying a directory containing the plugins to be used. This
enables the use of different plugin sets for the north- resp. southbound API.</p><p><strong>Note</strong>: In a plugin directory, all <em>executable</em> files (including symlinks to executables) are assumed to be plugins.
Non-executable files, like configuration files, are excluded. For deterministic behavior, plugins are sorted and
executed in lexicographic order based on their filenames during the startup of wfx.</p><h3 id=developing-plugins>Developing Plugins</h3><p>Communication between wfx and a plugin is achieved by exchanging
<a href=https://flatbuffers.dev/ target=_blank>flatbuffer</a> messages via
stdin/stdout. The flatbuffer specification is available in the
<a href=https://github.com/siemens/wfx/tree/main/fbs target=_blank>fbs</a>
directory. A plugin can use <code>stderr</code> for logging purposes (<code>stderr</code> is forwarded and prefixed by wfx).</p><p>For every incoming request, wfx generates a unique number called <code>cookie</code>. The <code>cookie</code>, along with the complete request
(e.g., headers and body in the case of HTTP), is written to the plugin&rsquo;s stdin. The plugin then sends its response,
paired with the same <code>cookie</code>, back to wfx by writing to its stdout. This <code>cookie</code> mechanism ensures that wfx can
accurately associate responses with their corresponding requests.</p><p><strong>Technical Note</strong>: Cookies are represented as unsigned 64-bit integers, which may lead to wraparound. This means there
is a slight possibility that a cookie could be reused for more than one request over the lifespan of a plugin. However,
this event occurs only once every 2^64 requests. By the time such a reuse might happen, the original request associated
with the cookie would have already timed out.</p><p><strong>Note</strong>:</p><ol><li>It is crucial for the plugin to read data from its stdin descriptor promptly to prevent blocking writes by wfx. The
<code>cookie</code> mechanism facilitates (and encourages!) asynchronous processing.</li><li>The working directory for the plugin process is the same as the working directory of wfx, which is the directory
from which wfx was launched.</li></ol><p>Based on the plugin&rsquo;s response, wfx can:</p><ul><li>Modify the incoming request before it undergoes further processing by wfx in the usual manner.</li><li>Send a preemptive response back to the client, such as a &ldquo;permission denied&rdquo; or &ldquo;service unavailable&rdquo; message.</li><li>Leave the request unchanged.</li></ul><h3 id=use-cases>Use Cases</h3><p>Plugins are typically used for:</p><ul><li>Enforcing authentication and authorization for API endpoints.</li><li>Handling URL rewriting and redirection tasks.</li></ul><h3 id=example>Example</h3><p>An
<a href=https://github.com/siemens/wfx/tree/main/example/plugin target=_blank>example plugin</a> written in Go demonstrates denying access
to the <code>/api/wfx/v1/workflows</code> endpoint.</p><h2 id=telemetry>Telemetry</h2><p>No telemetry or user data is collected or processed by wfx.</p><p>Note that there is an indirect dependency on <code>go.opentelemetry.io/otel</code> via
<a href=https://github.com/go-openapi target=_blank>Go OpenAPI</a>
by the <strong>client runtime</strong> (as used by <code>wfxctl</code>). Telemetry is deliberately turned off in wfx. See
<a href=https://github.com/go-openapi/runtime/pull/254 target=_blank>Add support for
tracing via OpenTelemetry</a> for details.</p><h2 id=performance--benchmarking>Performance / Benchmarking</h2><p>wfx has been designed with performance and horizontal scalability in mind.</p><p>To regress-test and gauge the performance of wfx in particular scenarios, the <code>wfx-loadtest</code> tool stressing the REST API
can be helpful. It&rsquo;s build by default alongside the other wfx binaries, see Section
<a href=../../docs/installation/#building-wfx>Building
wfx</a>.</p><p>As an example, the following commands execute a benchmark of the default SQLite persistent storage:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>wfx --log-format json --log-level warn <span style=color:#1f2328>&amp;</span>
</span></span><span style=display:flex><span>wfx-loadtest --log-level warn --duration 60s
</span></span></code></pre></div><p>Note: In the above example, the log format is JSON since pretty-printing is an expensive operation.</p><p>The benchmark result including statistics is printed to the terminal after 60 seconds and also available in the
<code>results</code> directory for further inspection.</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>*******************************************************************************
</span></span><span style=display:flex><span> Summary
</span></span><span style=display:flex><span>*******************************************************************************
</span></span><span style=display:flex><span>Requests      [total, rate, throughput]         6000, 100.02, 100.02
</span></span><span style=display:flex><span>Duration      [total, attack, wait]             59.987s, 59.986s, 792.516µs
</span></span><span style=display:flex><span>Latencies     [min, mean, 50, 90, 95, 99, max]  187.363µs, 612.69µs, 602.423µs, 744.281µs, 809.622µs, 1.062ms, 7.242ms
</span></span><span style=display:flex><span>Bytes In      [total, mean]                     4041243, 673.54
</span></span><span style=display:flex><span>Bytes Out     [total, mean]                     81693, 13.62
</span></span><span style=display:flex><span>Success       [ratio]                           100.00%
</span></span><span style=display:flex><span>Status Codes  [code:count]                      200:5625  201:375
</span></span><span style=display:flex><span>Error Set:
</span></span></code></pre></div><p>and is to be interpreted as follows: There were 6,000 total requests at a rate of 100.02 requests per second. In terms
of latency, the minimum response time was 187.363 microseconds, the mean was 612.69 microseconds, and the 99th
percentile was 1.062 milliseconds. All requests were successful with a success ratio of 100%. The status codes indicate
that a total of 5,625 status updates were sent with HTTP error code 200 and 375 jobs were created with HTTP error code
201. No errors were reported.</p><p>The latency over time distribution is illustrated in the following figure:
<a href=../../benchmark.png><img src=../../benchmark.png alt="benchmark
plot"></a></p></div></main></div></div><footer class="td-footer row d-print-none"><div class=container-fluid><div class="row mx-md-2"><div class="td-footer__left col-6 col-sm-4 order-sm-1"></div><div class="td-footer__right col-6 col-sm-4 order-sm-3"><ul class=td-footer__links-list><li class=td-footer__links-item data-bs-toggle=tooltip title=GitHub aria-label=GitHub><a target=_blank rel=noopener href=https://github.com/siemens/wfx aria-label=GitHub><i class="fab fa-github"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title="Siemens Open Source" aria-label="Siemens Open Source"><a target=_blank rel=noopener href=https://opensource.siemens.com/ aria-label="Siemens Open Source"><i class="fa fa-heart"></i></a></li></ul></div><div class="td-footer__center col-12 col-sm-4 py-2 order-sm-2"></div></div></div></footer></div><script src=../../js/main.min.403ff095218c662472dab60ed98ecbb19431682de5ac7c6159891241cd366af5.js integrity="sha256-QD/wlSGMZiRy2rYO2Y7LsZQxaC3lrHxhWYkSQc02avU=" crossorigin=anonymous></script><script defer src=../../js/click-to-copy.min.73478a7d4807698aed7e355eb23f9890ca18fea3158604c8471746d046702bad.js integrity="sha256-c0eKfUgHaYrtfjVesj+YkMoY/qMVhgTIRxdG0EZwK60=" crossorigin=anonymous></script><script src=../../js/tabpane-persist.js></script></body></html>